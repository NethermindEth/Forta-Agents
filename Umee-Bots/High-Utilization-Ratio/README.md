# High Utilization Rate Monitoring Bot

## Description

This bot monitors the utilization rate of pools in the Umee protocol every block, emitting a finding if it's large or
had a large increase.
The bot's behavior can be customized by editing the configuration fields in `src/agent.config.ts`.

## Supported Chains

- Ethereum

## Alerts

- UMEE-7-1
  - Fired when a pool's utilization ratio absolute value is large
  - Severity is always set to "low"
  - Type is always set to "info"
  - Metadata:
    - `asset`: The address of the reserve asset
    - `usageRatio`: The current usage ratio for this reserve

- UMEE-7-2
  - Fired when a pool's utilization ratio increase (relative to the previous block) is large
  - Severity is always set to "low"
  - Type is always set to "info"
  - Metadata:
    - `asset`: The address of the reserve asset
    - `usageRatio`: The current usage ratio for this reserve
    - `percentageIncrease`: The increase relative to the previous block in %

## Test Data

### Mainnet

Uncomment the lines indicated in `src/agent.config.ts` and run:

```
npm run start
```

This configuration emits UMEE-7-1 findings for reserves with usage ratios above `0` and UMEE-7-2 findings for reserves
with usage ratios that are increased by at least `0%` from the previous block (see `CONFIG.absoluteThreshold` and
`CONFIG.percentageThreshold`).
In the first block to be processed, all reserves should emit a UMEE-7-1 finding, and will do so each ~30s (see
`CONFIG.alertCooldown.absolute`).
From the second block onwards, every block should trigger UMEE-7-2 findings for every reserve (see
`CONFIG.alertCooldown.percentage`).

### Kovan Testnet (PoC)

The following test was generated by interacting with PoC contracts (available at the `PoC/` directory) deployed on the
Kovan testnet.

In order to check the results, uncomment the lines indicated in `src/agent.config.ts`, set a Kovan testnet RPC (e.g.
`https://kovan.poa.network`) as `jsonRpcUrl` in your `forta.config.json` file and run:

```
npm run range 32036349..32036360
```

At block `32036331`, `MockLendingPool.test1()` was called and, at block `32036349`, `MockLendingPool.test2()` was
called. Since the test starts at `32036349`, findings will be emitted at first for `reserves[1]` and `reserves[2]`
since both of them are at or above `0.9` usage ratio.

Then, at block `32036354` `MockLendingPool.test3()` is called, which then sets `reserves[0]` usage ratio from `0.8`
to `0.9`, triggering absolute and increase percentage threshold findings, and also sets `reserves[2]` usage ratio to
`~0.167`.

At block `32036360`, the absolute threshold finding cooldown for `reserves[1]`, whose usage ratio is still `~0.917`,
is over. Because of this, another finding is emitted for this reserve.
