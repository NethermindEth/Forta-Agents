# Large UToken Exchange Rate Drop

## Description

This bot detects large uToken/uToken ratio drop.

The bot's behavior can be customized by editing the configuration fields in `src/agent.config.ts`.

The uToken that needs to be watched, has to be added into `uTokens` array with their `uToken address`.

uToken pairs (e.g. `uDAI/uUSDT`) can be customized in `uTokenPairs` array. Each pair has to have their threshold values.

- `threshold`: The minimum difference that will trigger the alert
- `difference`: Severity of the drop. Severity increases with each difference level. For example:
  - Let's assume that `uDAI/uUSDT` pair has 0.10 threshold. and 0.05 difference levels. This means that the bot will alert if the ratio is dropped more than 0.10. The severity will increase by each 0.05 increase of the ratio.
    - `Info`: 0.10 - 0.15
    - `Low`: 0.15-0.20
    - `Medium`: 0.20-0.25
    - `High`: 0.25-0.30
    - `Critical`: 0.30+

## Supported Chains

- Ethereum

## Alerts

- UMEE-2
  - Fired when a uToken/uToken pair ratio is dropped largely
  - Severity can be "info", "low", "medium", "high", "critical" depending on size of the drop
  - Type is always set to "info"
  - Metadata:
    - `pair`: pair of uTokens
    - `previousRatio`: previous ratio of the uToken pair before drop
    - `currentRatio`: current ratio of the uToken pair after drop

## Test Data

### Mainnet

Uncomment the lines indicated in `src/agent.config.ts` and run:

```
npm run range 14924789..14924790
```

A finding might be emitted when processing block 14924789 comparing with the prices when the test is initialized. Hovewer 2 findings will be emitted when processing block 14924790 since there is a drop from block 14924789 to 14924790

### Kovan Testnet (PoC)

The following test was generated by interacting with PoC contracts (available at the `PoC/` directory) deployed on the Kovan testnet.

In order to check the results, uncomment the lines indicated in `src/agent.config.ts`, set a Kovan testnet RPC (e.g. `https://kovan.poa.network`) as `jsonRpcUrl` in your `forta.config.json` file and run:

```
npm run range 31887196..31887197
```

In the block 31887197, the price of uUSDT gets changed and the ratio between `uUSDC/uUSDT` and `uDAI/uUSDT` drops largely.
