# Health Factors Monitoring Bot

## Description

This bot monitors the health factors of borrowing positions in the UMEE protocol.
The bot's behavior can be customized by editing the configuration fields in `src/agent.config.ts`.

## Supported Chains

- Ethereum

## Alerts

- UMEE-1
  - Fired when a large borrowing position is close to liquidation
  - Severity is always set to "medium"
  - Type is always set to "info"
  - Metadata:
    - `address`: borrower address
    - `healthFactor`: health factor of the borrow position
    - `totalCollateralUsd`: the value of the position's collateral in USD

## Test Data

### Mainnet

Uncomment the lines indicated in `src/agent.config.ts` and run:

```
npm run range 14797593..14797595
```

A finding will be emitted when processing block 14797594.

### Kovan Testnet (PoC)

The following test was generated by interacting with PoC contracts (available at the `PoC/` directory) deployed on the Kovan testnet.

In order to check the results, uncomment the lines indicated in `src/agent.config.ts`, set a Kovan testnet RPC (e.g. `https://kovan.poa.network`) as `jsonRpcUrl` in your `forta.config.json` file and run:

```
npm run block 31712345,31712346,31712347,31712405,31712406
```

In the block `31712345`, `MockLendingPool.generateTestingData1()` is executed. From the examples, the only positions that will keep being monitored starting from this block are from `address(3)` and `address(4)`.

In the next block, since `address(4)` position has >$2M in collateral and health factor 1, a finding will be emitted.

In the block `31712405`, `MockLendingPool.generateTestingData2()` is then executed. This changes the health factor of `address(3)` position to 1, which will make the bot emit a finding.
